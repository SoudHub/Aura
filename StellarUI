local Players = game:GetService("Players")
local UIS = game:GetService("UserInputService")
local CoreGui = game:GetService("CoreGui")

-- CLEAN
pcall(function()
    CoreGui:FindFirstChild("StellarUI"):Destroy()
end)

-- GUI
local Gui = Instance.new("ScreenGui")
Gui.Name = "StellarUI"
Gui.ResetOnSpawn = false
Gui.Parent = CoreGui

-- MAIN
local Main = Instance.new("Frame", Gui)
Main.Size = UDim2.fromScale(0.45, 0.55)
Main.Position = UDim2.fromScale(0.5, 0.5)
Main.AnchorPoint = Vector2.new(0.5, 0.5)
Main.BackgroundColor3 = Color3.fromRGB(20,20,20)
Main.BorderSizePixel = 0
Instance.new("UICorner", Main).CornerRadius = UDim.new(0,10)

-- DRAG
do
    local drag, startPos, startInput
    Main.InputBegan:Connect(function(i)
        if i.UserInputType == Enum.UserInputType.MouseButton1 then
            drag = true
            startInput = i.Position
            startPos = Main.Position
        end
    end)
    UIS.InputChanged:Connect(function(i)
        if drag and i.UserInputType == Enum.UserInputType.MouseMovement then
            local delta = i.Position - startInput
            Main.Position = startPos + UDim2.fromOffset(delta.X, delta.Y)
        end
    end)
    UIS.InputEnded:Connect(function(i)
        if i.UserInputType == Enum.UserInputType.MouseButton1 then
            drag = false
        end
    end)
end

-- SIDEBAR
local Sidebar = Instance.new("Frame", Main)
Sidebar.Size = UDim2.new(0,130,1,0)
Sidebar.BackgroundColor3 = Color3.fromRGB(25,25,25)
Sidebar.BorderSizePixel = 0
Instance.new("UICorner", Sidebar).CornerRadius = UDim.new(0,10)

local TabLayout = Instance.new("UIListLayout", Sidebar)
TabLayout.Padding = UDim.new(0,6)
TabLayout.HorizontalAlignment = Center

-- PAGES
local Pages = Instance.new("Frame", Main)
Pages.Position = UDim2.new(0,140,0,10)
Pages.Size = UDim2.new(1,-150,1,-20)
Pages.BackgroundTransparency = 1

-- LIB
local Library = {}
local CurrentPage

function Library:AddTab(name)
    -- TAB BUTTON
    local TabBtn = Instance.new("TextButton", Sidebar)
    TabBtn.Size = UDim2.new(1,-10,0,32)
    TabBtn.Text = name
    TabBtn.Font = Enum.Font.GothamBold
    TabBtn.TextSize = 13
    TabBtn.TextColor3 = Color3.new(1,1,1)
    TabBtn.BackgroundColor3 = Color3.fromRGB(35,35,35)
    TabBtn.BorderSizePixel = 0
    Instance.new("UICorner", TabBtn).CornerRadius = UDim.new(0,6)

    -- PAGE
    local Page = Instance.new("ScrollingFrame", Pages)
    Page.Size = UDim2.fromScale(1,1)
    Page.CanvasSize = UDim2.new()
    Page.ScrollBarImageTransparency = 1
    Page.Visible = false
    Page.AutomaticCanvasSize = Enum.AutomaticSize.None

    local PageLayout = Instance.new("UIListLayout", Page)
    PageLayout.Padding = UDim.new(0,10)

    PageLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
        Page.CanvasSize = UDim2.new(0,0,0,PageLayout.AbsoluteContentSize.Y + 10)
    end)

    TabBtn.MouseButton1Click:Connect(function()
        if CurrentPage then CurrentPage.Visible = false end
        Page.Visible = true
        CurrentPage = Page
    end)

    if not CurrentPage then
        Page.Visible = true
        CurrentPage = Page
    end

    local Tab = {}

    function Tab:AddSection(title)
        local Section = Instance.new("Frame", Page)
        Section.BackgroundColor3 = Color3.fromRGB(30,30,30)
        Section.BorderSizePixel = 0
        Section.AutomaticSize = Enum.AutomaticSize.Y
        Instance.new("UICorner", Section).CornerRadius = UDim.new(0,6)

        local Layout = Instance.new("UIListLayout", Section)
        Layout.Padding = UDim.new(0,6)

        local Padding = Instance.new("UIPadding", Section)
        Padding.PaddingTop = UDim.new(0,8)
        Padding.PaddingBottom = UDim.new(0,8)
        Padding.PaddingLeft = UDim.new(0,8)
        Padding.PaddingRight = UDim.new(0,8)

        local Title = Instance.new("TextLabel", Section)
        Title.Size = UDim2.new(1,0,0,20)
        Title.BackgroundTransparency = 1
        Title.Text = title
        Title.Font = Enum.Font.GothamBold
        Title.TextSize = 14
        Title.TextColor3 = Color3.new(1,1,1)
        Title.TextXAlignment = Left

        local SectionAPI = {}

        function SectionAPI:AddToggle(data)
            local Btn = Instance.new("TextButton", Section)
            Btn.Size = UDim2.new(1,0,0,30)
            Btn.BackgroundColor3 = Color3.fromRGB(40,40,40)
            Btn.BorderSizePixel = 0
            Btn.Font = Enum.Font.Gotham
            Btn.TextSize = 13
            Btn.TextColor3 = Color3.new(1,1,1)
            Instance.new("UICorner", Btn).CornerRadius = UDim.new(0,6)

            local state = data.Default or false
            Btn.Text = data.Name .. ": " .. (state and "ON" or "OFF")

            Btn.MouseButton1Click:Connect(function()
                state = not state
                Btn.Text = data.Name .. ": " .. (state and "ON" or "OFF")
                pcall(data.Callback, state)
            end)
        end

        function SectionAPI:AddButton(data)
            local Btn = Instance.new("TextButton", Section)
            Btn.Size = UDim2.new(1,0,0,30)
            Btn.Text = data.Name
            Btn.Font = Enum.Font.GothamBold
            Btn.TextSize = 13
            Btn.TextColor3 = Color3.new(1,1,1)
            Btn.BackgroundColor3 = Color3.fromRGB(45,45,45)
            Btn.BorderSizePixel = 0
            Instance.new("UICorner", Btn).CornerRadius = UDim.new(0,6)

            Btn.MouseButton1Click:Connect(function()
                pcall(data.Callback)
            end)
        end

        return SectionAPI
    end

    return Tab
end
